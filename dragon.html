<!DOCTYPE html>
<meta charset="utf-8">
	<head>
	</head>
	
	<body>
		<div id="root"></div>
		<script src="https://d3js.org/d3.v3.min.js"></script>
		<script>

"use strict"
const svgsize = 800
const cellsize = 2
const center = svgsize/2



const svg = d3.select("#root").append("svg")
  .attr("width",svgsize)
  .attr("height",svgsize)
  .style("background","#ddd")

const arc = (i) => { // takes arguments 0,1,2,3 representing quadrants
  return (
   d3.svg.arc()
    .innerRadius(cellsize-0.5)
    .outerRadius(cellsize+0.5)
    .startAngle(Math.PI/2 * i)
    .endAngle(Math.PI/2 * (i + 1))
  )
}

const LEFT = 0, RIGHT = 1, UP = 2, DOWN = 3
const START = {position:[0,0], orientation:UP}

function NextSegment(direction, from = START) {

	const {position, orientation} = from
  	// position is in virtual coordiantes, orientation is one of LEFT, RIGHT, UP, DOWN
 	 // and direction is one of LEFT or RIGHT indicating next cell position

  	var quadrant, offset, deltaPosition, nextOrientation
  
  	if (orientation === UP && direction === LEFT) {
    	quadrant = 0
    	offset = [-2,-1]
    	deltaPosition = [-1,-1]
    	nextOrientation = LEFT
  	}
  	else if (orientation === UP && direction === RIGHT){
    	quadrant = 3
    	offset = [0,-1]   	
    	deltaPosition = [1,-1]
    	nextOrientation = RIGHT
  	}
  	else if (orientation === RIGHT && direction === LEFT){
    	quadrant = 1
    	offset = [-1,-2]    	
    	deltaPosition = [1,-1]
    	nextOrientation = UP
  	}
  	else if (orientation === RIGHT && direction === RIGHT){
  		quadrant = 0
  		offset = [-1,0]
    	deltaPosition = [1,1]
    	nextOrientation = DOWN
	}
  	else if (orientation === DOWN && direction === LEFT){
    	quadrant = 2
    	offset = [0,-1]   	
    	deltaPosition = [1,1]
    	nextOrientation = RIGHT
  	}
  	else if (orientation === DOWN && direction === RIGHT){
  		quadrant = 1
  		offset = [-2,-1]
    	deltaPosition = [-1,1]
    	nextOrientation = LEFT
  	}
  	else if (orientation === LEFT && direction === LEFT){
    	quadrant = 3
    	offset = [-1,0]   	
    	deltaPosition = [-1,1]
    	nextOrientation = DOWN
  	}
  	else if (orientation === LEFT && direction === RIGHT){
    	quadrant = 2
    	offset = [-1,-2]   	
    	deltaPosition = [-1,-1]
    	nextOrientation = UP
  	}
  	else {
  		console.log("bad orientation:", orientation, "direction:", direction)
    }
  	const pos = position.map((p,i) => (p+offset[i])*cellsize+center)
  	svg.append("path")
    	.attr("d", arc(quadrant))
    	.attr("transform", "translate("+pos+")")
  
  	return {position: [position[0]+deltaPosition[0],position[1]+deltaPosition[1]], orientation: nextOrientation}
  
} 

const  nextDragonArray = (d) => {
    // d is the n-1st dragon array
    const l = d.length / 2;
    const dl = d.slice(0,l);
    const dr = d.slice(l+1);
    var out = d.slice(); // shallow copy
    out.push(RIGHT);
    out = out.concat(dl);
    out.push(LEFT);
    out = out.concat(dr);
    return out;
  }

const dragon = (n) => {
	if (n === 0){
		return [RIGHT]
	}
	return nextDragonArray(dragon(n-1))
}
const turns = dragon(14)
//const turns =[LEFT, LEFT, LEFT, RIGHT, LEFT, RIGHT, LEFT, RIGHT, LEFT, RIGHT, LEFT]

function sleep(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

async function drawDragon(){
	var a = START
	for(let t of turns){
		a = NextSegment(t, a)
		await sleep(50);
	}
}

drawDragon()


		</script>
	</body>
</html>